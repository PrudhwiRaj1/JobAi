{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
  .scrollable-table {
    max-height: 600px;
    overflow-y: auto;
    overflow-x: auto;
  }
  #message-container {
    position: fixed;
    top: 20px;
    width: 300px;
    z-index: 1000;
  }

.main-content
{
  max-width: 78%;
}
.container
{
  width: 100%;
}
  .header-table thead th {
    background: #007bff;
    color: white;
    padding: 5px;
    text-align: center;
  }
  .alert {
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 10px;
    animation: fadeOut 5s ease-in-out forwards;
  }
  table {
    width: 100%;
  }
  thead th {
    position: sticky;
    top: 0;
    background: #007bff;
    color: #fff;
    padding: 10px;
    border: 1px solid #dee2e6;
    text-align: left;
  }
  tbody td {
    padding: 8px;
    border: 1px solid #dee2e6;
    vertical-align: middle;
    word-wrap: break-word;
  }
  tbody tr:hover {
    background-color: #f1f1f1;
  }
  .no-data {
    text-align: center;
    font-weight: 600;
    color: #555;
    padding: 20px;
  }
  .scrollable-table th, 
.scrollable-table td {
  white-space: nowrap; /* Prevents text wrapping */
  overflow: hidden;
  text-overflow: ellipsis; /* Adds "..." for overflow text */
}
  .scrollable-table th:nth-child(1) { width: 15%; } /* Job Title */
.scrollable-table th:nth-child(2) { width: 20%; } /* Company */
.scrollable-table th:nth-child(3) { width: 25%; } /* Required Skills */
.scrollable-table th:nth-child(4) { width: 15%; } /* Eligibility */
.scrollable-table th:nth-child(5) { width: 15%; } /* Location */
.scrollable-table th:nth-child(6) { width: 10%; } /* Last Date */
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    fetch("{% url 'auto-apply' %}", {
      method: "POST",
      headers: {
        "X-CSRFToken": "{{ csrf_token }}",
        "Content-Type": "application/json"
      },
    })
    .then(response => response.text())
    .then(data => {
      console.log("Auto Apply Response:", data);
    })
    .catch(error => console.error("Error:", error));
  });
</script>

<h4 id="profile">Auto Apply</h4>
<h6 class="text-dark mt-3 fs-5 ms-5">Hello, {{ fname }}. Here are the recommended jobs based on your skills and eligibility:</h6>
  
{% if messages %}
    <div id="message-container">
      {% for message in messages %}
        <div class="alert {% if message.tags == 'success' %}alert-success{% else %}alert-warning{% endif %} fw-bold text-dark">
          {{ message }}
        </div>
      {% endfor %}
    </div>
    <script>
      setTimeout(function() {
        let messageContainer = document.getElementById("message-container");
        if (messageContainer) {
          messageContainer.style.transition = "opacity 0.5s";
          messageContainer.style.opacity = "0";
          setTimeout(() => messageContainer.remove(), 500);
        }
      }, 5000);
    </script>
  {% endif %}
<div class="container">
  {% if recommended_jobs %}
    <div class="scrollable-table">
      <table class="table table-striped table-bordered header-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Ack. No.</th>
            <th>Job Title</th>
            <th>Company</th>
            <th>Required Skills</th>
            <th>Eligibility</th>
            <th>Location</th>
            <th>Last Date</th>
          </tr>
        </thead>
        <tbody>
          {% for job in recommended_jobs %}
            <tr>
              <td>{{forloop.counter}}</td>
              <td>{{job.job_number}}</td>
              <td>{{ job.job_title.job_title }}</td>
              <td>{{ job.company.name }}</td>
              <td>{{ job.skills_required }}</td>
              <td>{{ job.highest_qualification }}</td>
              <td>{{ job.location }}</td>
              <td>{{ job.Lastdate|date:"d-M-Y" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-warning mt-3">No matching jobs found based on your profile.</div>
  {% endif %}
</div>
{% endblock %}
